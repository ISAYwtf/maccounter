# Code conventions

## Commits

Для правильного версионирования пакетов и генерации CHANGELOG необходимо создавать коммиты по
спецификации [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/).

Также в коммите нужно указывать задачу jira, в рамках которой ведется работа.

### Формат

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

`type` – тип коммита, который будет отображен в CHANGELOG. Для каждого npm пакета ведется свой CHANGELOG, в который
попадают изменения, произведенные именно в папке пакета. Например коммиты, касающиеся файлов в папке `packages/core`
не повлияют на CHANGELOG в `packages/icons`, и наоборот. Для автоматической генерации используются следующие типы
коммитов:

- `feat` или `feature` – добавление новой функциональности в библиотеку. Это может быть новый компонент (функция) или
доработка уже существующих
- `fix` или `bugfix` – исправление багов, ошибок и прочего
- `refactor` – изменение поведения компонента, либо внутренней организации кода в библиотеке
- `style` – изменение визуального отображения компонентов, без изменений в логике работы
- `figma` – выгрузка исходников из фигмы (иконки, цвета, палитра, типографика и тп)

__Если в коммите содержатся только изменения файлов сторибука, то `type` указывать не нужно__

`scope` – необязательный параметр, описывающий область кодовой базы, в которую были внесены изменения. Указывается в
круглых скобках. Названия пакетов, такие как `core` или `icons` здесь указывать не нужно, так как для каждого пакета
ведется отдельный Changelog.  
Пример: `docs(storybook): Добавлен базовый шрифт Roboto для всех Story`

`description` - основной текст коммита, который попадет в CHANGELOG. Если коммит выполнен в рамках работы над задачей
для разработки в JIRA, то `description` строится по форме `<jira issue>: <summary>`. В качестве задачи обычно
выступают __story__, __task__ или __sub-task__. Придерживаемся следующего правила: одна задача выполняется в один
коммит. Описание параметров:

- `summary` – название задачи, например: "Исследование и реалезация Changelog". Метки `[DEV]`, `[Storybook]` и прочие
  из названия задачи копировать не нужно. При отсутствии задачи в JIRA кратко указывается назначение коммита
- `jira issue` – номер задачи для разработки в jira, например `DSSX-199`. Некоторые коммиты могут не иметь прямого
  отношения ни к одной из задач JIRA, в таком случае `jira issue` не указывается

`body` – полный текст коммита, в генерации CHANGELOG не используется. Здесь может быть список изменений или их подробное
описание. `body` обязательно отделяется пустой строкой сверху, формат написания свободный

`footer` – отделяется от `body` пустой строкой, может быть использован для описания критических изменений
(см. __Breaking Changes__), или для приведения дополнительной информации в
формате [git trailer format](https://git-scm.com/docs/git-interpret-trailers)

### Breaking Changes

Иногда при развитии библиотеки приходится делать изменения, при которых пропадает совместимость с проектами,
использовавшими предыдущую версию. Такие изменения называются `Breaking Changes` и могут быть добавлены в CHANGELOG
двумя способами:

1) добавление `!` после префикса с типом и скоупом (`<type>[optional scope]!: <description>`). Используется в том случае,
   когда `description` коммита совпадает с критическими изменениями.  
   Пример: `refactor!: Убрана поддержка Internet Explorer`


2) добавления футера `BREAKING CHANGE: <description>`. Желательно использовать в большинтве случаев. Здесь могут
   быть подробно описаны все критические изменения, сообщение может быть многострочным. Критические изменения в логе
__отображаются отдельно от коммита__, поэтому не должны опираться на тест коммита. Пример использования футера
`BREAKING CHANGE` есть ниже.

### Примеры коммитов

Новая фича из JIRA:
```
feat: DSSX-205: Добавить хук для использования медиа-запросов
```

Новая фича из JIRA, с критическими изменениями:
```
feat: DSSX-190: Экспорт базовой типографики

BREAKING CHANGE: Изменен интерфейс и набор свойств базового объекта typography.
В случае необходимости работы с предудещей версией типографики, импортируйте из библиотеки объект typographyOld. 
```

Исправление бага из JIRA:
```
fix: DSSX-218: У HeadlineBlock нет пропа className
```

Исправление бага, найденного во время разрабоки:
```
fix: Дублируется className в Dropdown
```

Рефакторинг во время разработки:
```
refactor: Исправлены циклические зависимости
```

Добавление документации (`type` в этом случае не указывается):
```
DSSX-192: Hint+Tooltip. Добавление документации в StoryBook
```
